---
# Jenkins Configuration as Code (JCasC) ConfigMap
# This configures SonarQube integration for Jenkins
apiVersion: v1
kind: ConfigMap
metadata:
  name: jenkins-casc-config
  namespace: platform
  labels:
    app: jenkins
data:
  jenkins.yaml: |
    unclassified:
      sonarGlobalConfiguration:
        installations:
          - name: "SonarQube"
            serverUrl: "http://sonarqube.platform.svc.cluster.local"
            credentialsId: "sonarqube-token"
            triggers:
              skipScmCause: false
              skipUpstreamCause: false
    credentials:
      system:
        domainCredentials:
          - credentials:
              - string:
                  scope: GLOBAL
                  id: "sonarqube-token"
                  secret: "${SONAR_TOKEN}"
                  description: "SonarQube API Token"
              - usernamePassword:
                  scope: GLOBAL
                  id: "jira-creds"
                  username: "${JIRA_USERNAME}"
                  password: "${JIRA_PASSWORD}"
                  description: "Jira Basic Authentication"
              - usernamePassword:
                  scope: GLOBAL
                  id: "github-creds"
                  username: "${GITHUB_USERNAME}"
                  password: "${GITHUB_PAT}"
                  description: "GitHub Credentials"
    tool:
      sonarRunnerInstallation:
        installations:
          - name: "SonarScanner"
            properties:
              - installSource:
                  installers:
                    - sonarRunnerInstaller:
                        id: "5.0.1.3006"
